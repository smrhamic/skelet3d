<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <body>
        <ui:component>
            <c:set var="component" value="#{pageManager.components[listPosition]}" />
            
            <!-- Display if HEADLINE component -->
            <h:panelGroup class="headlineComp" layout="block"
                          rendered="#{component.componentType == 'headline'}">
                <h3>
                    <h:outputText value="#{component.text}" />
                </h3>
            </h:panelGroup>
            
            <!-- Display if TEXT component -->
            <h:panelGroup class="textComp" layout="block"
                          rendered="#{component.componentType == 'text'}">
                <p>
                    <h:outputText value="#{component.text}" />
                </p>
            </h:panelGroup>
            
            <!-- Display if IMAGE component -->
            <h:panelGroup class="imageComp" layout="block"
                          rendered="#{component.componentType == 'image'}">
                <h:graphicImage library="images" name="content/bone1.jpg" alt="#{component.description}" />
                <h:outputText class="imageDescription" value="#{component.description}" />
            </h:panelGroup>
            
            <!-- Display if MODEL component -->
            <h:panelGroup class="imageComp" layout="block"
                          rendered="#{component.componentType == 'model'}">
                <!-- hidden input for recieving updated data -->
                <h:form>
                    <h:inputHidden id="labelUpdate"
                                   value="#{pageManager.labelUpdates}"
                                   binding="#{labelUpdateInput}"/>
                    <h:commandButton id="labelUpdateButton"
                                     action="#{pageManager.updateLabels()}"
                                     binding="#{labelUpdateButton}"
                                     style="display: none;" />
                </h:form>
                <!-- required js libraries -->
                <h:outputScript name="js/three.min.js" />
                <h:outputScript name="js/OrbitControls.js" />
                <h:outputScript name="js/STLLoader.js" />
                <!-- container element for renderer -->
                <div id="container">
                    <!-- setup JS variables -->
                    <script type="text/javascript">
                        var editable = #{loginManager.editor};
                        var labelUpdateInput =
                                document.getElementById('#{labelUpdateInput.clientId}');
                        var labelUpdateButton =
                                document.getElementById('#{labelUpdateButton.clientId}');
                        var modelPath = './resources/models/${component.model.filename}';
                        var strings = {};
                            strings['selectLabel'] = '#{strings.selectLabel}';
                            strings['labels'] = '#{strings.showLabels}';
                            strings['pins'] = '#{strings.showPins}';
                            strings['none'] = '#{strings.showNoLabels}';
                            strings['addLabel'] = '#{strings.addLabel}';
                            strings['defaultTitle'] = '#{strings.defaultLabelTitle}';
                            strings['defaultText'] = '#{strings.defaultLabelText}';
                            strings['deleteLabel'] = '#{strings.deleteLabel}';
                            strings['confirmDelete'] = '#{strings.confirmDeleteLabel}';
                            strings['saveButton'] = '#{strings.saveButton}';
                            strings['confirmSave'] = '#{strings.confirmSave}';
                            strings['unsavedChanges'] = '#{strings.unsavedChanges}';
                        var labels = new Array(0);
                        <ui:repeat var="label" value="#{pageManager.labels}" varStatus="status">
                            var l = new Object();
                            l.id = #{label.id};
                            l.markX = #{label.markX};
                            l.markY = #{label.markY};
                            l.markZ = #{label.markZ};
                            l.labelX = #{label.labelX};
                            l.labelY = #{label.labelY};
                            l.labelZ = #{label.labelZ};
                            l.title = '#{label.title}';
                            l.text = '#{label.text}';
                            labels[#{status.index}] = l;
                        </ui:repeat>
                    </script>
                    <!-- 3D rendering code -->
                    <h:outputScript name="js/view3d.js" />
                </div>
                <h:outputText class="modelDescription" value="#{component.description}" />
            </h:panelGroup>
        </ui:component>
    </body>
</html>

